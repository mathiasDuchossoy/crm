{% extends '@MondofuteLogement/logementunifie/fiche_popup.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets 'css/datatables.css' %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
    <style type="text/css">
        .table-tarifs-logement td {
            height: 35px;
        }
    </style>
{% endblock %}
{% block title %}
    {{ 'logement.modification' | trans | capitalize }}
{% endblock %}

{#  GESTION DU TITRE A AFFICHER DANS LA PAGE #}
{% block titre %}
    {{ 'logement.modification' | trans | capitalize }}
{% endblock %}

{% block formulaire %}
    <ul class="list-unstyled">
        <li><a class="btn btn-default"
               href="{{ path('popup_logement_logement_clone',{'id': form.vars.value.id}) }}">{{ 'dupliquer' | trans }}</a>
        </li>
    </ul>

    {% set ongletLogementLocatifTarifs=1 %}
    {{ parent() }}
{% endblock %}
{#  BLOCK DES ACTIONS AUTRES QUE LA MISE A JOUR#}
{% block actions %}
    <div style="text-align: right">
        <ul class="list-unstyled">
            <li>
                <a href="{{ path('popup_logement_logement_index', {'idFournisseurHebergement':fournisseurHebergement.id}) }}">{{ ('retour.liste' | trans) | capitalize }}</a>
            </li>
            <li>{{ form(delete_form) }}</li>
        </ul>

    </div>

{% endblock %}

{#  GESTION DU BLOCK CONTENANT LE JAVASCRIPT#}
{% block javascripts %}
    {{ parent() }}
    {% javascripts
    'js/datatables.min.js'
    'js/tarifs-locatif.min.js'
    'js/type-periodes-onglets.min.js'
    'js/progressbar.min.js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script type="text/javascript">
<<<<<<< HEAD
        // Initialisation des variables js
        var datatableLangue = {
            language: {
                processing: "{{ 'processing'|trans }}",
                search: "{{ 'rechercher'|trans }} :",
                loadingRecords: "{{ 'chargementEnCours'|trans }}...",
                "lengthMenu": "{{ 'afficher'|trans }} _MENU_ {{ 'resultats'|trans }}",
                zeroRecords: "{{ 'zeroResultats'|trans }}",
                emptyTable: "{{ 'tableVide'|trans }}",
                "paginate": {
                    "first": "{{ 'page.premiere'|trans }}",
                    "last": "{{ 'page.derniere'|trans }}",
                    "next": "{{ 'page.suivante'|trans }}",
                    "previous": "{{ 'page.precedente'|trans }}"
                },
                aria: {
                    sortAscending: ": activer pour trier la colonne par ordre croissant",
                    sortDescending: ": activer pour trier la colonne par ordre décroissant"
                }
            },
            colonnes: [{
                'mDataProp': "periode",
                title: 'periode',
            }, {'mDataProp': "prix_public", title: 'prix public'}, {
                'mDataProp': "prix_fournisseur",
                title: 'prix fournisseur'
            }, {'mDataProp': "prix_achat", title: 'prix d\'achat'}, {
                'mDataProp': "stock",
                title: 'stock'
            }]
        };
||||||| parent of 8a4c7ff... externalisation des javascripts pour pouvoir gérer facilement la minification plus tard
        $(document).delegate('a[data-toggle="tab"]', 'shown.bs.tab', function (e) {
            $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
        });
        function genererDataTables($tableau, colonnes, parametres, $progressBar, callback) {
            var table = $tableau.DataTable({
                columns: colonnes,
                "fnCreatedRow": function (nRow, aData, iDataIndex) {
                    $(nRow).find('td').attr('style', 'vertical-align: middle;');
                },
                paging: true,
                info: false,
                aoColumnDefs: [
                    {"orderable": true, aTargets: 0},
                    {"orderable": false, aTargets: ['_all']},
                ],
                "order": [[0, "asc"]],
                "aaSorting": [[0, 'asc']],
                pageLength: 25,
                scrollX: true,
                scrollY: false,
                scrollCollapse: true,
                fixedColumns: true,
                scroller: {
                    rowHeight: 50,
                },
                language: {
                    processing: "{{ 'processing'|trans }}",
                    search: "{{ 'rechercher'|trans }} :",
                    loadingRecords: "{{ 'chargementEnCours'|trans }}...",
                    "lengthMenu": "{{ 'afficher'|trans }} _MENU_ {{ 'resultats'|trans }}",
                    zeroRecords: "{{ 'zeroResultats'|trans }}",
                    emptyTable: "{{ 'tableVide'|trans }}",
                    "paginate": {
                        "first": "{{ 'page.premiere'|trans }}",
                        "last": "{{ 'page.derniere'|trans }}",
                        "next": "{{ 'page.suivante'|trans }}",
                        "previous": "{{ 'page.precedente'|trans }}"
                    },
                    aria: {
                        sortAscending: ": activer pour trier la colonne par ordre croissant",
                        sortDescending: ": activer pour trier la colonne par ordre décroissant"
                    }
                }
            });
            if (callback != null) {
                callback(table, parametres, $progressBar);
            }
            return table;
        }
    </script>
    <script type="text/javascript">
        // Initialisation des variables js
=======

    </script>
    <script type="text/javascript">
        // Initialisation des variables js
        var datatableLangue = {
            language: {
                processing: "{{ 'processing'|trans }}",
                search: "{{ 'rechercher'|trans }} :",
                loadingRecords: "{{ 'chargementEnCours'|trans }}...",
                "lengthMenu": "{{ 'afficher'|trans }} _MENU_ {{ 'resultats'|trans }}",
                zeroRecords: "{{ 'zeroResultats'|trans }}",
                emptyTable: "{{ 'tableVide'|trans }}",
                "paginate": {
                    "first": "{{ 'page.premiere'|trans }}",
                    "last": "{{ 'page.derniere'|trans }}",
                    "next": "{{ 'page.suivante'|trans }}",
                    "previous": "{{ 'page.precedente'|trans }}"
                },
                aria: {
                    sortAscending: ": activer pour trier la colonne par ordre croissant",
                    sortDescending: ": activer pour trier la colonne par ordre décroissant"
                }
            },
            colonnes: [{
                'mDataProp': "periode",
                title: 'periode',
            }, {'mDataProp': "prix_public", title: 'prix public'}, {
                'mDataProp': "prix_fournisseur",
                title: 'prix fournisseur'
            }, {'mDataProp': "prix_achat", title: 'prix d\'achat'}, {
                'mDataProp': "stock",
                title: 'stock'
            }]
        };
>>>>>>> 8a4c7ff... externalisation des javascripts pour pouvoir gérer facilement la minification plus tard
        var logementUnifieId = parseInt({{ logementUnifie.id }});
        var donnees = Array();
        var urlEnregistrementTarifs = "{{ path('mondofute_catalogue_enregistrer_tarifs_locatif') }}";
        var urlChargerTypePeriodeListe = "{{ path('periode_type_periode_liste') }}";
        var urlTypePeriodeOnglets = "{{ path('periode_type_periode_onglets') }}";
        {% for logement in logementUnifie.logements %}
        {% if logement.site.crm %}
        {% for periode in logement.periodes %}
        if (donnees[{{ periode.periode.type.id }}] == null) {
            donnees[{{ periode.periode.type.id }}] = Array();
        }
        donnees[{{ periode.periode.type.id }}].push({
            'periode': '<span style="display:none;">{{ periode.periode.debut | date('Ymd') }}{{ periode.periode.fin | date('Ymd') }}</span> du {{ periode.periode.debut | date('d-m-Y') }} au {{ periode.periode.fin | date('d-m-Y') }}',
            'prix_public': genererInputTarifLocatif('prixPublic',{{ periode.locatif.prixPublic }},{{ periode.periode.id }}),
            'prix_fournisseur': genererInputTarifLocatif('prixFournisseur',{{ periode.locatif.prixFournisseur }},{{ periode.periode.id }}),
            'prix_achat': genererInputTarifLocatif('prixAchat',{{ periode.locatif.prixAchat }},{{ periode.periode.id }}),
            'stock': genererInputTarifLocatif('stock',{{ periode.locatif.stock }},{{ periode.periode.id }}),
        });
        {% endfor %}
        {% endif %}
        {% endfor %}
<<<<<<< HEAD
        $(document).delegate('button#logement_unifie_submit', 'click', function (e) {
            var $form = $(this).closest('form');
            if ($form.get(0).checkValidity() == true) {
                desactiveChamps($form, ['input[name^="prixPublic"]', 'input[name^="prixFournisseur"]', 'input[name^="prixAchat"]', 'input[name^="stock"]']);
            }
        });
||||||| parent of 8a4c7ff... externalisation des javascripts pour pouvoir gérer facilement la minification plus tard
        // gestion des évènements
        $(document).delegate('.table-tarifs-logement input', 'change', function (e) {
            modificationDonneesTarifs($(this));
        });
        $(document).delegate('[name="btnEnregistrerTarifs"]', 'click', enregistrerTarifs);

        //        fonctions
        function modificationDonneesTarifs($obj) {
            var datas = $obj.data();
            donneesModifiees[datas.periode_id] = {
                prixPublic: $('input[name="prixPublic[' + datas.periode_id + ']"]').val(),
                prixFournisseur: $('input[name="prixFournisseur[' + datas.periode_id + ']"]').val(),
                prixAchat: $('input[name="prixAchat[' + datas.periode_id + ']"]').val(),
                stock: $('input[name="stock[' + datas.periode_id + ']"]').val(),
            };
        }
        function genererInputTarif(name, valeur, idPeriode, length) {
            return '<input class="form-control" data-periode_id="' + idPeriode + '" name="' + name + '[' + idPeriode + ']" value="' + valeur + '"/>';
        }
=======

>>>>>>> 8a4c7ff... externalisation des javascripts pour pouvoir gérer facilement la minification plus tard
        $(document).ready(function () {
            $conteneur = $('#data_logement_locatif_tarifs');
            chargerTarifsLocatif($conteneur);
        });
    </script>

{% endblock %}
